#!/bin/ksh
# Copyright (c) 2025 Robert August Vincent II <pillarsdotnet@gmail.com>
# Co-author: Cursor-AI.
# Copy timesheet scripts to a directory on PATH and make them executable.
# Optional first argument: installation directory. If omitted, use the first
# writable directory on PATH. Optional second argument: repo path (default: directory of this script).

set -e
SCRIPT_DIR=$(dirname "$0")
[ -n "$2" ] && SCRIPT_DIR=$2

SCRIPTS="start started stop timesheet timeoff"

# Determine installation directory.
if [ -n "$1" ]; then
  DEST="$1"
  if [ ! -d "$DEST" ]; then
    mkdir -p "$DEST" || {
      echo "install: cannot create directory $DEST" >&2
      exit 1
    }
  fi
  if [ ! -w "$DEST" ]; then
    echo "install: directory is not writable: $DEST" >&2
    exit 1
  fi
else
  DEST=""
  old_IFS=$IFS
  IFS=:
  for dir in $PATH; do
    [ -z "$dir" ] && dir="."
    if [ -d "$dir" ] && [ -w "$dir" ]; then
      DEST=$dir
      break
    fi
  done
  IFS=$old_IFS
  if [ -z "$DEST" ]; then
    echo "install: no writable directory on PATH. Specify an installation directory." >&2
    exit 1
  fi
fi

for f in $SCRIPTS; do
  if [ ! -f "$SCRIPT_DIR/$f" ]; then
    echo "install: missing $SCRIPT_DIR/$f" >&2
    exit 1
  fi
  cp "$SCRIPT_DIR/$f" "$DEST/$f"
  chmod +x "$DEST/$f"
  echo "Installed $DEST/$f"
done
echo "Done. Scripts are in $DEST and executable."
